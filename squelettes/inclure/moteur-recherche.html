[(#REM) 
    Moteur de recherche de Badje. La fonction traiter du fomulaire construit la requête SQL qui s'occupe de ce moteur.
    Dans le cas de string virgule comme la période on filtre les résultat après la séléction par la boucle.
]
<B_recherche>
<h1 class="moteur_titre">[#GRAND_TOTAL (#GRAND_TOTAL|singulier_ou_pluriel{<:activite_trouve:>, <:activites_trouves:>})]</h1>

<div class="onglet">
    <ul>
        <li><:tri:></li>
        <li class="tri_commune">
            <a href="[(#SELF|parametre_url{tri, commune})]" title="<:tri_commune:>" class="ajax"><:commune:></a>
        </li>
        <li class="tri_type">
            <a href="[(#SELF|parametre_url{tri, type})]" title="<:tri_commune:>" class="ajax"><:type:></a>
        </li>
        <li class="retour_recherche"><a href="[(#URL_SITE_SPIP|parametre_url{retour_recherche, 1})]" title="<:retour_recherche:>">[(#CHEMIN{images/loupe_retour.png}|balise_img{loupe_retour, loupe_retour})]<:retour_recherche:></a></li>
    </ul>
</div>
<div class="container-recherche">

<!-- TODO: trier selon les communes, mais regrouper les activités par organismes. -->
<!-- TODO: Gestion de "toutes les communes". -->

[(#REM) On boucle sur le résultat de la recherche ]
<BOUCLE_recherche(DATA){source table, #ENV{badje_recherche}}>

    [(#REM) Affichage de la localité, mais une seul fois seulement ! ]
    [(#GET{save_localite}|!={#VALEUR{commune}}|oui) 
        <h2><span>#VALEUR{commune}</span></h2> 
    ]
    [(#SET{save_localite, #VALEUR{commune}})]
    
    <INCLURE{fond=inclure/cadre_activite, env, id_activite=#VALEUR{id_activite}}>

</BOUCLE_recherche>
</div>
</B_recherche>
<div class="container-recherche">
<p><:aucun_resultat:></p>
<a href="[(#URL_SITE_SPIP|parametre_url{retour_recherche, 1})]" title="<:retour_recherche:>"><:retour_recherche:></a>
</div>
<//B_recherche>