[(#REM) 
    Moteur de recherche de Badje, la boucle est le principal élément qui constitue ce moteur.
    Dans le cas de string virgule comme la période on filtre les résultat après la séléction par la boucle.
]
<B_recherche>
<h1 class="moteur_titre">[#GRAND_TOTAL (#GRAND_TOTAL|singulier_ou_pluriel{<:activite_trouve:>, <:activites_trouves:>})]</h1>

<div class="onglet">
    <ul>
        <li><:tri:></li>
        <li>
            <a href="[(#SELF|parametre_url{tri, commune})]" title="<:tri_commune:>" class="ajax"><:commune:></a>
        </li>
        <li><:type:></li>
        <li class="retour_recherche"><a href="[(#URL_SITE_SPIP|parametre_url{retour_recherche, 1})]" title="<:retour_recherche:>"><:retour_recherche:></a></li>
    </ul>
</div>
<div class="container-recherche">
[(#REM) On boucle avec les filtres que l'on peu mettre ]
<BOUCLE_recherche(BADJE_ACTIVITES spip_badje_organismes_liens spip_badje_organismes)  {recherche ?}
                                    {code_postal ?IN #ENV{code_postal}}
                                    {age_min ?<= #ENV{age_min}}
                                    {age_max ?>= #ENV{age_max}}
                                    {id_type_activite ?IN #ENV{id_type_activite}}
                                    {accueil_handicap ?= on}
                                    {accessibilite_handicap ?= on}
                                    {par spip_badje_organismes.localite}>
    
    [(#REM) On va créer un tableau avec la période de l'activité. ]
    [(#SET{tableau_periode, #PERIODE|get_array_periode})]

    [(#REM) 
        On fait une boucle sur ce tableau et on test chaque valeur. 
        On test aussi qu'une période à bien été envoyée.
    ]
    <BOUCLE_search_periode(DATA){source table, #GET{tableau_periode}} {si #ENV{periode}|oui}>
        [(#ENV{periode}|find{#VALEUR}|oui)
            #SET{afficher, oui}
        ]
    </BOUCLE_search_periode>

    [(#REM) Si aucune période n'a été envoyée, on affiche toujours les données. ]
    #SET{afficher, oui}
    <//B_search_periode>
    
    [(#REM) On affiche les données. ]
    [(#GET{afficher}|=={oui}|oui)
        
        [(#REM) Affichage de la localité, mais une seul fois seulement ! ]
        [(#GET{save_localite}|!={#LOCALITE}|oui) <h2><span>#LOCALITE</span></h2> ]
        [(#SET{save_localite, #LOCALITE})]

        <INCLURE{fond=inclure/cadre_activite, env, id_activite}>
    ]
</BOUCLE_recherche>
</div>
</B_recherche>
<p><:aucun_resultat:></p>
<a href="[(#URL_SITE_SPIP|parametre_url{retour_recherche, 1})]" title="<:retour_recherche:>"><:retour_recherche:></a>
<//B_recherche>